!function(i,r){var e=Backbone.Model.extend({defaults:{template_id:0,title:"",source:"",type:"",subtype:"",author:"",thumbnail:"",url:"",export_link:"",tags:[]}}),o=Backbone.Collection.extend({model:e}),e=Marionette.Behavior.extend({ui:{insertButton:".elementor-template-library-template-insert"},events:{"click @ui.insertButton":"onInsertButtonClick"},onInsertButtonClick:function(){var e={model:this.view.model};$e.run("sina_ext/insert-template",e)}}),t=Marionette.ItemView.extend({className:function(){var e="elementor-template-library-template",t=this.model.get("source");return e+=" elementor-template-library-template-remote",e+=" elementor-template-library-template-"+t,"sina_ext"===t&&(e+=" elementor-template-library-template-"+this.model.get("type")),this.model.get("isPro")&&(e+=" elementor-template-library-pro-template"),e},ui:function(){return{previewButton:".elementor-template-library-template-preview"}},events:function(){return{"click @ui.previewButton":"onPreviewButtonClick"}},behaviors:{insertTemplate:{behaviorClass:e}}}),n=t.extend({template:"#tmpl-elementor-template-library-template-sina-ext",ui:function(){return jQuery.extend(t.prototype.ui.apply(this,arguments),{favoriteCheckbox:".elementor-template-library-template-favorite-input"})},events:function(){return jQuery.extend(t.prototype.events.apply(this,arguments),{"change @ui.favoriteCheckbox":"onFavoriteCheckboxChange"})},onPreviewButtonClick:function(){$e.route("sina_ext/preview",{model:this.model})},onFavoriteCheckboxChange:function(){var e=this.ui.favoriteCheckbox[0].checked;this.model.set("favorite",e),sina_ext_templates_lib.templates.markAsFavorite(this.model,e),!e&&sina_ext_templates_lib.templates.getFilter("favorite")&&i.channels.templates.trigger("filter:change")}}),a=Marionette.ItemView.extend({template:"#tmpl-elementor-template-library-preview",id:"elementor-template-library-preview",ui:{iframe:"> iframe"},onRender:function(){this.ui.iframe.attr("src",this.getOption("url"))}}),l=Marionette.ItemView.extend({template:"#tmpl-elementor-template-library-header-preview-sina-ext",id:"elementor-template-library-header-preview",behaviors:{insertTemplate:{behaviorClass:e}}}),s=Marionette.ItemView.extend({template:"#tmpl-elementor-template-library-header-back",id:"elementor-template-library-header-preview-back",events:{click:"onClick"},onClick:function(){$e.routes.restoreState("sina_ext")}}),m=Marionette.CompositeView.extend({template:"#tmpl-elementor-template-library-templates-sina-ext",id:"elementor-template-library-templates",childViewContainer:"#elementor-template-library-templates-container",reorderOnSort:!0,ui:{textFilter:"#elementor-template-library-filter-text",selectFilter:".elementor-template-library-filter-select",myFavoritesFilter:"#elementor-template-library-filter-my-favorites",orderInputs:".elementor-template-library-order-input",orderLabels:"label.elementor-template-library-order-label"},events:{"input @ui.textFilter":"onTextFilterInput","change @ui.selectFilter":"onSelectFilterChange","change @ui.myFavoritesFilter":"onMyFavoritesFilterChange","mousedown @ui.orderLabels":"onOrderLabelsClick"},comparators:{title:function(e){return e.get("title").toLowerCase()}},getChildView:function(e){return n},initialize:function(){this.listenTo(i.channels.templates,"filter:change",this._renderChildren)},filter:function(r){var e=sina_ext_templates_lib.templates.getFilterTerms(),a=!0;return jQuery.each(e,function(e){var t=sina_ext_templates_lib.templates.getFilter(e);if(t){if(this.callback){var n=this.callback.call(r,t);return n||(a=!1),n}e=t===r.get(e);return e||(a=!1),e}}),a},order:function(e,t){e=this.comparators[e]||e;t&&(e=this.reverseOrder(e)),this.collection.comparator=e,this.collection.sort()},reverseOrder:function(n){var t;return"function"!=typeof n&&(t=n,n=function(e){return e.get(t)}),function(e,t){e=n(e),t=n(t);return void 0===e?-1:void 0===t||e<t?1:t<e?-1:0}},addSourceData:function(){var e=this.children.isEmpty();this.$el.attr("data-template-source",e?"empty":sina_ext_templates_lib.templates.getFilter("source"))},setFiltersUI:function(){this.$(this.ui.selectFilter).select2({placeholder:i.translate("category"),allowClear:!0,width:150,dropdownParent:this.$el})},setMasonrySkin:function(){var e=new elementorModules.utils.Masonry({container:this.$childViewContainer,items:this.$childViewContainer.children()});this.$childViewContainer.imagesLoaded(e.run.bind(e))},toggleFilterClass:function(){this.$el.toggleClass("elementor-templates-filter-active",!(!sina_ext_templates_lib.templates.getFilter("text")&&!sina_ext_templates_lib.templates.getFilter("favorite")))},onRender:function(){"sina_ext"===sina_ext_templates_lib.templates.getFilter("source")&&this.setFiltersUI()},onRenderCollection:function(){this.addSourceData(),this.toggleFilterClass(),"sina_ext"===sina_ext_templates_lib.templates.getFilter("source")&&"page"!==sina_ext_templates_lib.templates.getFilter("type")&&this.setMasonrySkin()},onBeforeRenderEmpty:function(){this.addSourceData()},onTextFilterInput:function(){sina_ext_templates_lib.templates.setFilter("text",this.ui.textFilter.val())},onSelectFilterChange:function(e){var t=jQuery(e.currentTarget),e=t.data("elementor-filter");sina_ext_templates_lib.templates.setFilter(e,t.val())},onMyFavoritesFilterChange:function(){sina_ext_templates_lib.templates.setFilter("favorite",this.ui.myFavoritesFilter[0].checked)},onOrderLabelsClick:function(e){var t,e=jQuery(e.currentTarget.control);e[0].checked||(t="asc"!==e.data("default-ordering-direction")),e.toggleClass("elementor-template-library-order-reverse",t),this.order(e.val(),e.hasClass("elementor-template-library-order-reverse"))}}),u=Marionette.ItemView.extend({template:"#tmpl-elementor-templates-modal__header__logo-sina-ext",className:function(){return"elementor-templates-modal__header__logo"},events:function(){return{click:"onClick"}},templateHelpers:function(){return{title:this.getOption("title")}},onClick:function(){var e=this.getOption("click");e&&e()}}),c=Marionette.ItemView.extend({template:"#tmpl-elementor-template-library-header-actions-sina-ext",id:"elementor-template-library-header-actions",ui:{sync:"#elementor-template-library-header-sync i"},events:{"click @ui.sync":"onSyncClick"},onSyncClick:function(){var e=this;e.ui.sync.addClass("eicon-animation-spin"),sina_ext_templates_lib.templates.requestLibraryData({onUpdate:function(){e.ui.sync.removeClass("eicon-animation-spin"),$e.routes.refreshContainer("sina_ext")},forceUpdate:!0,forceSync:!0})}}),p=Marionette.ItemView.extend({template:"#tmpl-elementor-template-library-header-menu",id:"elementor-template-library-header-menu",templateHelpers:function(){return{tabs:$e.components.get("sina_ext").getTabs()}}}),d=elementorModules.common.views.modal.Layout.extend({getModalOptions:function(){return{id:"elementor-template-library-modal",effects:{show:"show",hide:"hide"}}},getLogoOptions:function(){return{title:"Sina Extension Templates",click:function(){return $e.run("sina_ext/open",{toDefault:!0}),!1}}},getTemplateActionButton:function(e){var t="#tmpl-elementor-template-library-insert-button";e.isPro&&"inactive"===e.proStatus&&(t="#tmpl-elementor-template-library-get-pro-button-sina-ext"),e.isPro&&"license_inactive"===e.proStatus&&(t="#tmpl-elementor-pro-template-library-activate-license-button-sina-ext");t=Marionette.TemplateCache.get(t);return Marionette.Renderer.render(t)},setHeaderDefaultParts:function(){var e=this.getHeaderView();e.tools.show(new c),e.menuArea.show(new p),this.showLogo()},showLogo:function(){this.getHeaderView().logoArea.show(new u(this.getLogoOptions()))},showTemplatesView:function(e){this.modalContent.show(new m({collection:e}))},showPreviewView:function(e){this.modalContent.show(new a({url:e.get("url")}));var t=this.getHeaderView();t.menuArea.reset(),t.tools.show(new l({model:e})),t.logoArea.show(new s)}}),h=function(e){var a;function t(){return Object.getPrototypeOf(t).apply(this,arguments)}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.setPrototypeOf(t,e);var n=Object.getPrototypeOf(t.prototype);return t.prototype.__construct=function(e){n.__construct.call(this,e),a=this,i.on("document:loaded",this.onDocumentLoaded.bind(this))},t.prototype.getNamespace=function(){return"sina_ext"},t.prototype.defaultTabs=function(){return{"templates/blocks":{title:"Blocks",getFilter:function(){return{source:"sina_ext",type:"block",subtype:i.config.document.remoteLibrary.category}}},"templates/pages":{title:"Pages",filter:{source:"sina_ext",type:"page"}}}},t.prototype.defaultRoutes=function(){return{preview:function(e){this.manager.layout.showPreviewView(e.model)}}},t.prototype.defaultCommands=function(){return Object.assign(n.defaultCommands.call(this),{open:this.show,"insert-template":this.insertTemplate})},t.prototype.defaultShortcuts=function(){return{open:{keys:"ctrl+shift+p"}}},t.prototype.onDocumentLoaded=function(e){this.setDefaultRoute("templates/blocks"),this.maybeOpenLibrary()},t.prototype.renderTab=function(e){e=this.tabs[e],e=e.getFilter?e.getFilter():e.filter;this.manager.setScreen(e)},t.prototype.activateTab=function(e){$e.routes.saveState("sina_ext"),n.activateTab.call(this,e)},t.prototype.open=function(){return n.open.call(this),this.manager.layout||(this.manager.layout=this.layout),this.manager.layout.setHeaderDefaultParts(),!0},t.prototype.close=function(){return!!n.close.call(this)&&(this.manager.modalConfig={},!0)},t.prototype.show=function(e){!(a.manager.modalConfig=e).toDefault&&$e.routes.restoreState("sina_ext")||$e.route(a.getDefaultRoute())},t.prototype.insertTemplate=function(e){var n=e.model,r=e.withPageSettings||null;null===r&&n.get("hasPageSettings")?a.getImportSettingsDialog().showImportDialog(n):(a.manager.layout.showLoadingView(),a.manager.requestTemplateContent(n.get("source"),n.get("template_id"),{data:{with_page_settings:r},success:function(e){var t=jQuery.extend({},a.manager.modalConfig.importOptions);t.withPageSettings=r,a.manager.layout.hideLoadingView(),a.manager.layout.hideModal(),$e.run("document/elements/import",{model:n,data:e,options:t})},error:function(e){a.manager.showErrorDialog(e)},complete:function(){a.manager.layout.hideLoadingView()}}),t.prototype.getImportSettingsDialog=function(){var n={dialog:null,showImportDialog:function(e){var t=n.getDialog();t.onConfirm=function(){$e.run("library/insert-template",{model:e,withPageSettings:!0})},t.onCancel=function(){$e.run("library/insert-template",{model:e,withPageSettings:!1})},t.show()},initDialog:function(){n.dialog=elementorCommon.dialogsManager.createWidget("confirm",{id:"elementor-insert-template-settings-dialog",headerMessage:i.translate("import_template_dialog_header"),message:i.translate("import_template_dialog_message")+"<br>"+i.translate("import_template_dialog_message_attention"),strings:{confirm:i.translate("yes"),cancel:i.translate("no")}})},getDialog:function(){return n.dialog||n.initDialog(),n.dialog}};return n})},t.prototype.getTabsWrapperSelector=function(){return"#elementor-template-library-header-menu"},t.prototype.getModalLayout=function(){return d},t.prototype.maybeOpenLibrary=function(){"#sina_ext"===location.hash&&($e.run("sina_ext/open"),location.hash="")},t}($e.modules.ComponentModalBase);sina_ext_templates_lib.templates=new function(){var e,n=this,r={},t={},a=!1;this.modalConfig={};this.getFilter=function(e){return i.channels.templates.request("filter:"+e)},this.setFilter=function(e,t,n){i.channels.templates.reply("filter:"+e,t),n||i.channels.templates.trigger("filter:change")},this.setScreen=function(e){i.channels.templates.stopReplying(),n.setFilter("source",e.source,!0),n.setFilter("type",e.type,!0),n.setFilter("subtype",e.subtype,!0),n.showTemplates()},this.getTemplatesCollection=function(){return a},this.getConfig=function(e){return e?r[e]||{}:r},this.getFilterTerms=function(e){return e?t[e]:t},this.requestLibraryData=function(t){var e;!a||t.forceUpdate?(t.onBeforeUpdate&&t.onBeforeUpdate(),e={data:{},success:function(e){a=new o(e.templates),e.config&&(r=e.config),t.onUpdate&&t.onUpdate()}},t.forceSync&&(e.data.sync=!0),elementorCommon.ajax.addRequest("sina_get_library_data",e)):t.onUpdate&&t.onUpdate()},this.loadTemplates=function(e){n.requestLibraryData({onBeforeUpdate:n.layout.showLoadingView.bind(n.layout),onUpdate:function(){n.layout.hideLoadingView(),e&&e()}})},this.showTemplates=function(){n.layout.setHeaderDefaultParts(),n.layout.showModal(),n.loadTemplates(function(){var e=n.filterTemplates();n.layout.showTemplatesView(new o(e))})},this.filterTemplates=function(){return a.filter(function(e){return"sina_ext"===e.get("source")&&("block"===e.get("type")||"page"===e.get("type"))})},this.requestTemplateContent=function(e,t,n){t={unique_id:t,data:{source:e,edit_mode:!0,display:!0,template_id:t}};return n&&jQuery.extend(!0,t,n),elementorCommon.ajax.addRequest("get_template_data",t)},this.markAsFavorite=function(e,t){t={data:{source:e.get("source"),template_id:e.get("template_id"),favorite:t}};return elementorCommon.ajax.addRequest("mark_template_as_favorite",t)},this.getErrorDialog=function(){return e=e||elementorCommon.dialogsManager.createWidget("alert",{id:"elementor-template-library-error-dialog",headerMessage:i.translate("an_error_occurred")})},this.showErrorDialog=function(e){var t;"object"==typeof e?(t="",_.each(e,function(e){t+="<div>"+e.message+".</div>"}),e=t):e?e+=".":e="<i>&#60;The error message is empty&#62;</i>",n.getErrorDialog().setMessage(i.translate("templates_request_error")+'<div id="elementor-template-library-error-info">'+e+"</div>").show()},this.init=function(){t={text:{callback:function(t){return t=t.toLowerCase(),0<=this.get("title").toLowerCase().indexOf(t)||_.any(this.get("tags"),function(e){return 0<=e.toLowerCase().indexOf(t)})}},type:{},subtype:{},favorite:{}},this.component=$e.components.register(new h({manager:this}))}},sina_ext_templates_lib.templates.init(),i.on("document:loaded",function(){var t=i.$previewContents,e=r("<style />");e.html(".elementor-add-section-area-button.sina-ext-add-template-button { margin-left: 8px; vertical-align: bottom; }.elementor-add-section-area-button.sina-ext-add-template-button img { height: 40px; }"),t.find("head").append(e);var n=r("<div />");n.addClass("elementor-add-section-area-button sina-ext-add-template-button"),n.attr("title","Add Sina Extension Template"),n.html('<img src="'+sina_ext_templates_lib.logoUrl+'" />'),n.insertAfter(t.find(".elementor-add-section-area-button.elementor-add-template-button")),n.on("click",function(){$e.run("sina_ext/open")}),t.find("body").delegate(".elementor-editor-element-add","click",function(e){setTimeout(function(){var e=t.find("body").find(".elementor-add-section-inner");0<e.length&&(e.find(".sina-ext-add-template-button").remove(),n.off("click").on("click",function(){$e.run("sina_ext/open")}),n.insertAfter(e.find(".elementor-add-section-area-button.elementor-add-template-button")))},100)})})}(elementor,jQuery,window);